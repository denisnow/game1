<!doctype html>

<html lang="en">

	<head>

		<meta charset="utf-8">
		<title>Game 1</title>

		<style>

			@import url("https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap");

			body {
				background-image: url('./img/bg.gif');
			}

			.box {
				position: absolute;
 				width: 396px;
				left: 50%;
				top: 50%;
				margin: -200px 0 0 -198px;
			}

			.block {
				position: absolute;
			}

			.blockNumber {
				display: table-cell;
				position: relative;
				text-align: center;
				vertical-align: middle;
				height: 96px;
 				width: 96px;
			}

			.text {
				background-color: white;
				opacity: 0.77;
				font-family: "Roboto Mono", monospace;
				font-size: 28px;
				color: #298f91;
			}

			.clickable {
				cursor: pointer;
			}

		</style>

	</head>

	<body>

		<noscript>
			<span class="text">This page requires JavaScript.</span><br><br>
			<span class="text">Your browser doesn't support JavaScript or JavaScript is disabled.</span><br><br>
			<span class="text">Here are the <a href="https://www.enable-javascript.com/">instructions how to enable JavaScript in your browser</a>.</span>
		</noscript>

		<script>

			var matrix, box;
			var empty = {}; //void

			function makeMatrix() {

				var arr = [];
				var arrIndex = 0;

				function makeArray() {

					function shuffleArray() {

						var random, temp;

						for (var i = arr.length-1; i > 0; i--) {
							random = Math.floor(Math.random()*(i+1));
							if (arr[random] !== arr[i]) {
								temp = arr[random];
								arr[random] = arr[i];
								arr[i] = temp;
							}
						}
					}

					for (var i=0; i<16; i++) arr.push(i);
					shuffleArray();
				}

				makeArray();
				matrix = [];
				for (var i = 0; i < 4; i++) {
					matrix[i] = [];
					for (var j = 0; j < 4; j++) {
						matrix[i][j] = {};
						matrix[i][j].value = arr[arrIndex++];
					}
				}
			}

			function renderBoard() {

				function renderBox() {

					box = document.createElement("div");
					box.className = "box";
					document.body.appendChild(box);
				}

				function renderBlocks() {

					var block, blockNumber;

					for (var i = 0; i < 4; i++) {
						for (var j = 0; j < 4; j++) {
							if (matrix[i][j].value) {
								block = document.createElement("div");
								block.className = "block";
								block.setAttribute("style", "left: " + 100*j + "px; top: " + 100*i + "px;");
								block.m=i;
								block.n=j;
								blockNumber = document.createElement("div");
								blockNumber.className = "blockNumber text";
								blockNumber.textContent = (matrix[i][j].value);
								block.appendChild(blockNumber);
								box.appendChild(block);
								matrix[i][j].element = block;
							}
							else {
								empty.m = i;
								empty.n = j;
							}
						}
					}
				}

				renderBox();
				renderBlocks();
			}

			function makeBoardClickable() {

				function processPotentiallyMovableBlocks(callback) {

					for (var i = 0; i < 4; i++) {
						if (i !== empty.n) callback(matrix[empty.m][i].element);
						if (i !== empty.m) callback(matrix[i][empty.n].element);
					}
				}

				function addClass(element, classNameToAdd) {
					element.className += " " + classNameToAdd;
				}

				function onButtonClick (e) {

 					var classArr = e.target.parentNode.className.split(" ");

					if (classArr.indexOf("clickable") !== -1) console.log(matrix[e.target.parentNode.m][e.target.parentNode.n].value);
				}

				function makeBlocksMovable (element) {

					addClass(element, "clickable");
					box.addEventListener("click", onButtonClick, false);
				}

				processPotentiallyMovableBlocks(makeBlocksMovable)
			}

			makeMatrix();
			renderBoard();
			makeBoardClickable();

		</script>

	</body>

</html>